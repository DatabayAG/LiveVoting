var xlvoPlayer={init:function(e){var t=JSON.parse(e),l=new RegExp("amp;","g");t.base_url=t.base_url.replace(l,""),this.config=t,this.ready=!0,xlvoPlayer.log(this.config)},buttons_handled:!1,toolbar_loaded:!1,delay:1e3,counter:1,timeout:null,request_pending:!1,forced_update_interval:3,config:{base_url:"",voter_count_element_id:"",lng:{player_voters_online:"Online",voting_confirm_reset:"Reset?"},status_running:-1,use_mathjax:!1,debug:!1},player:{status:-1,active_voting_id:-1,show_results:!1,frozen:!0,last_update:0,counter:0,is_first:!0,is_last:!1,attendees:0,votes:0},run:function(){xlvoPlayer.log("running player"),this.registerElements(),this.getPlayerData()},handleFullScreen:function(){this.btn_close_fullscreen.parent().hide();var e=$("div.ilTabsContentOuter"),t=e[0],l=this;this.btn_start_fullscreen.click(function(){screenfull.enabled&&screenfull.request(t)}),this.btn_close_fullscreen.click(function(){screenfull.enabled&&screenfull.exit(t)}),screenfull.enabled&&document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?(e.addClass("xlvo-fullscreen"),l.btn_start_fullscreen.parent().hide(),l.btn_close_fullscreen.parent().show()):(e.removeClass("xlvo-fullscreen"),l.btn_start_fullscreen.parent().show(),l.btn_close_fullscreen.parent().hide())})},registerElements:function(){$(document).keydown(function(e){switch(e.which){case xlvoPlayer.config.keyboard.toggle_results:xlvoPlayer.callPlayer("toggle_results");break;case xlvoPlayer.config.keyboard.toggle_freeze:case 66:xlvoPlayer.callPlayer("toggle_freeze");break;case 33:case xlvoPlayer.config.keyboard.previous:xlvoPlayer.callPlayer("previous");break;case 34:case xlvoPlayer.config.keyboard.next:xlvoPlayer.callPlayer("next");break;default:return}e.preventDefault()}),this.btn_freeze=$("#btn-freeze"),this.btn_previous=$("#btn-previous"),this.btn_next=$("#btn-next"),this.btn_unfreeze=$("#btn-unfreeze"),this.btn_unfreeze.parent().hide(),this.btn_reset=$("#btn-reset"),this.btn_reset.parent().attr("disabled",!0),this.btn_hide_results=$("#btn-hide-results"),this.btn_show_results=$("#btn-show-results"),this.btn_show_results.parent().hide(),this.btn_start_fullscreen=$("#btn-start-fullscreen"),this.btn_close_fullscreen=$("#btn-close-fullscreen"),this.div_display_results=$("#xlvo-display-results"),this.toolbar=$("nav.ilToolbar"),this.toolbar.prepend('<div id="xlvo_player_loading"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'),this.toolbar_loader=$("#xlvo_player_loading"),this.toolbar_loader.show(),this.btn_freeze.click(function(){return xlvoPlayer.callPlayer("toggle_freeze"),!1}),this.btn_unfreeze.click(function(){return xlvoPlayer.callPlayer("toggle_freeze"),!1}),this.btn_hide_results.click(function(){return xlvoPlayer.callPlayer("toggle_results"),!1}),this.btn_show_results.click(function(){return xlvoPlayer.callPlayer("toggle_results"),!1}),this.btn_reset.click(function(){return window.confirm(xlvoPlayer.config.lng.voting_confirm_reset)&&xlvoPlayer.callPlayer("reset"),!1}),this.btn_next.click(function(){return xlvoPlayer.callPlayer("next"),!1}),this.btn_previous.click(function(){return xlvoPlayer.callPlayer("previous"),!1}),this.handleFullScreen()},initElements:function(){this.player.frozen?(this.btn_freeze.parent().hide(),this.btn_unfreeze.parent().show(),this.player.votes>0?this.btn_reset.removeAttr("disabled"):this.btn_reset.attr("disabled","disabled")):(this.btn_unfreeze.parent().hide(),this.btn_freeze.parent().show(),this.btn_reset.attr("disabled","disabled")),this.player.show_results?(this.btn_hide_results.parent().show(),this.btn_show_results.parent().hide(),this.div_display_results.show()):(this.btn_hide_results.parent().hide(),this.btn_show_results.parent().show(),this.div_display_results.hide()),this.player.is_last&&(this.btn_next.attr("disabled","disabled"),this.btn_previous.removeAttr("disabled")),this.player.is_first&&(this.btn_previous.attr("disabled","disabled"),this.btn_next.removeAttr("disabled")),this.player.is_last||this.player.is_first||(this.btn_next.removeAttr("disabled"),this.btn_previous.removeAttr("disabled")),this.player.is_last&&this.player.is_first&&(this.btn_next.attr("disabled","disabled"),this.btn_previous.attr("disabled","disabled"));var e=document.getElementById("xlvo-attendees");e.innerHTML=this.player.attendees+" Online"},startRequest:function(){xlvoPlayer.clearTimeout(),xlvoPlayer.request_pending=!0},endRequest:function(){xlvoPlayer.request_pending=!1},isRequestPending:function(){return!1},clearTimeout:function(){xlvoPlayer.timeout&&(xlvoPlayer.log("clear timeout"),clearTimeout(xlvoPlayer.timeout))},getPlayerData:function(){$.get(xlvoPlayer.config.base_url,{cmd:"getPlayerData"}).done(function(e){if(xlvoPlayer.counter++,xlvoPlayer.counter>xlvoPlayer.forced_update_interval||e.player.last_update!=xlvoPlayer.player.last_update||e.player.show_results!=xlvoPlayer.player.show_results||e.player.status!=xlvoPlayer.player.status||e.player.active_voting_id!=xlvoPlayer.player.active_voting_id){var t=e.player_html;$("#xlvo-display-player").replaceWith('<div id="xlvo-display-player">'+t+"</div>"),xlvoPlayer.config.use_mathjax&&MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub]),xlvoPlayer.counter=0,xlvoPlayer.buttons_handled=!1}xlvoPlayer.player=e.player,xlvoPlayer.handleQuestionButtons(e.buttons_html),xlvoPlayer.initElements(),xlvoPlayer.timeout=setTimeout(xlvoPlayer.getPlayerData,xlvoPlayer.delay)})},handleSwitch:function(){xlvoPlayer.toolbar_loader.show(),xlvoPlayer.buttons_handled=!1,xlvoPlayer.counter=99},callPlayer:function(e,t,l,r){if(!xlvoPlayer.isRequestPending()){xlvoPlayer.startRequest(),xlvoPlayer.toolbar_loader.show();var t=t?t:function(){},l=l?l:function(){},r=r?r:null;$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",{call:e,xvi:r}).done(function(e){e?(xlvoPlayer.clearTimeout(),xlvoPlayer.handleSwitch(),xlvoPlayer.getPlayerData(),xlvoPlayer.endRequest(),t()):(xlvoPlayer.endRequest(),l())})}},callButton:function(e,t){xlvoPlayer.isRequestPending()||(xlvoPlayer.startRequest(),xlvoPlayer.toolbar_loader.show(),this.log("call Button: "+e),$.post(xlvoPlayer.config.base_url+"&cmd=apiCall",{call:"button",button_id:e,button_data:t}).done(function(e){xlvoPlayer.handleSwitch(),xlvoPlayer.getPlayerData(),xlvoPlayer.endRequest()}))},open:function(e){return this.callPlayer("open",!1,!1,e),!1},updateAttendees:function(){xlvoPlayer.isRequestPending()||(xlvoPlayer.startRequest(),$.get(this.base_url,{cmd:"getAttendees"}).done(function(e){$("#xlvo-attendees").html(e+" Online"),xlvoPlayer.timeout=setTimeout(xlvoPlayer.updateAttendees,1e3),xlvoPlayer.endRequest()}))},handleStartButton:function(){var e=$("#btn-start-voting");e.click(function(t){return xlvoPlayer.clearTimeout(),t.altKey?(window.location.href=e.attr("href")+"&preview=1&key=1",!1):!0})},handleQuestionButtons:function(e){if(xlvoPlayer.buttons_handled)return void this.log("buttons already handled for this question");var t=$("<div/>").html(e).contents(),l=t.find("ul.ilToolbarItems"),r=l.find(".btn").length,n=this.toolbar.find("ul.ilToolbarItems"),a=n.find("li#dynamic_sep");return 1>r||!e||""===e?(a.length>0&&(a.nextAll().remove(),a.remove()),xlvoPlayer.log("there are no custom buttons"),xlvoPlayer.buttons_handled=!0,void xlvoPlayer.toolbar_loader.hide()):(xlvoPlayer.log("there are custom buttons!"),l.find(".btn").each(function(){$(this).addClass("xlvo_custom_button")}),a.length>0?(xlvoPlayer.log("removing everything after separator"),a.nextAll().remove()):(xlvoPlayer.log("appending separator"),n.append("<li id='dynamic_sep' class='ilToolbarSeparator hidden-xs'></li>")),n.append(l.html()),n.find(".xlvo_custom_button").on("click",function(){xlvoPlayer.callButton($(this).attr("id"),!0)}),xlvoPlayer.toolbar_loader.hide(),void(xlvoPlayer.buttons_handled=!0))},log:function(e){this.config.debug&&console.log(e)}};